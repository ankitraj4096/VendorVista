<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Live Vendor Map | StreetSymphony</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Poppins&display=swap" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    :root {
      --primary: #58c061;
      --primary-dark: #357138;
      --secondary: #fffef7;
      --accent: #fbe27a;
      --card-bg: #f7fdf6;
      --border: #dbeadb;
      --shadow: 0 6px 30px rgba(41, 88, 40, 0.12);
      --text-dark: #232c1e;
      --text-light: #526a3b;
      --button: #26c485;
      --button-text: #fff;
    }
    *, *::before, *::after { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      font-family: 'Poppins', Arial, sans-serif;
      background: var(--secondary);
      color: var(--text-dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header.navbar {
      width: 100vw;
      padding: 15px 0;
      background: var(--primary);
      color: #fff;
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      font-size: 1.35rem;
      display: flex;
      justify-content: center;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 4px 14px rgba(0,0,0,0.13);
      border-radius: 0 0 18px 18px;
      min-width: 0;
    }
    .navbar-inner {
      width: 100%;
      max-width: 1200px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    nav.main-nav {
      display: flex;
      gap: 26px;
      flex-wrap: wrap;
      align-items: center;
    }
    nav.main-nav a {
      color: #fff;
      text-decoration: none;
      font-weight: 700;
      font-size: 1.05rem;
      padding-bottom: 2px;
      border-bottom: 2.5px solid transparent;
      transition: color 0.2s, border-bottom-color 0.2s;
      position: relative;
    }
    nav.main-nav a:hover,
    nav.main-nav a.active {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }
    .map-layout {
      width: 100%;
      max-width: 1200px;
      margin: 40px auto 20px auto;
      display: flex;
      gap: 32px;
      min-height: 520px;
    }
    #map {
      flex: 3.2;
      height: 520px;
      min-width: 320px;
      border-radius: 18px;
      box-shadow: 0 7px 28px #afd37527;
      outline: 3px solid var(--border);
      outline-offset: -2px;
      background: #eaffd1;
    }
    aside.map-sidebar {
      flex: 1.3;
      display: flex;
      flex-direction: column;
      gap: 28px;
      min-width: 265px;
      background: var(--card-bg);
      border-radius: 1.15em;
      box-shadow: var(--shadow);
      padding: 28px 20px;
      align-self: flex-start;
      max-width: 380px;
      margin-top: 0;
      margin-bottom: 28px;
    }
    .sidebar-section { margin-bottom: 0; }
    .sidebar-section h2 {
      font-family: 'Montserrat', sans-serif;
      font-weight: 800;
      color: var(--primary-dark);
      font-size: 1.19rem;
      margin: 0 0 11px 0;
    }
    .filters { display: flex; gap: 10px; margin-bottom: 12px; flex-wrap: wrap; }
    .filter-chip {
      background: var(--button);
      border: none;
      border-radius: 1.1em;
      padding: 7px 18px;
      font-weight: 700;
      color: var(--button-text);
      cursor: pointer;
      font-size: 1.01rem;
      box-shadow: 0 2px 14px #26c48544;
      transition: background 0.19s;
      outline: none;
    }
    .filter-chip.active, .filter-chip:focus-visible {
      background: var(--primary-dark);
      color: #fff;
    }
    .alert-badge {
      background: var(--accent);
      color: #684d00;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      font-size: 0.99rem;
      padding: 6px 14px;
      border-radius: 14px;
      margin-bottom: 9px;
      user-select: none;
    }
    .sidebar-list {
      margin: 4px 0 0 0;
      padding: 0 0 0 17px;
      color: var(--text-light);
      font-size: 1rem;
      list-style: disc;
    }
    .sidebar-list li { margin-bottom: 8px; font-weight: 600; }
    .sidebar-list .highlight { color: var(--primary-dark); font-weight: 800; }
    .sidebar-section ul:last-child li:last-child { margin-bottom: 0; }
    @media (max-width: 1000px) {
      .map-layout { flex-direction: column; gap: 20px; }
      #map { height: 320px; min-width: 0; }
      aside.map-sidebar { max-width: 100%; width: 100%; margin-bottom: 0; }
    }
    @media (max-width: 600px) {
      .navbar-inner, .map-layout, main.container { max-width: 100vw; }
      aside.map-sidebar { padding: 18px 5vw; }
      .navbar-inner { flex-direction: column; gap: 12px; }
    }
    .leaflet-popup-content { font-family: "Poppins", Arial, sans-serif; font-size: 1rem; color: #224; }
    .leaflet-popup-content-wrapper { box-shadow: 0 7px 22px #acd9861c !important; }
    .leaflet-popup-tip { background: var(--primary) !important; }
  </style>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
  <script>
    // ROLE LOGIC: Use your own auth/session logic here!
    // For development/testing, set in console:
    // localStorage.setItem('userRole', 'vendor') or 'buyer'
    const currentUserRole = localStorage.getItem('userRole') || 'buyer';
  </script>
  <header class="navbar" role="banner">
    <div class="navbar-inner">
      <span style="font-family:'Montserrat',sans-serif;font-size:1.4rem;font-weight:900;letter-spacing:1px;">StreetSymphony</span>
      <nav class="main-nav" role="navigation" aria-label="Primary navigation" id="navLinks"></nav>
    </div>
  </header>
  <main class="container" style="width:100%;max-width:unset;background:none;box-shadow:none;padding:0;margin:0;">
    <div class="map-layout">
      <div id="map" aria-label="Vendor locations map" tabindex="0"></div>
      <aside class="map-sidebar" aria-label="Map sidebar information">
        <section class="sidebar-section">
          <h2>Filters</h2>
          <div class="filters" role="group" aria-label="Filter by vendor status">
            <button class="filter-chip active" data-status="all" type="button"><i class="bi bi-geo-alt-fill"></i> All</button>
            <button class="filter-chip" data-status="online" type="button"><i class="bi bi-universal-access-circle"></i> Online</button>
            <button class="filter-chip" data-status="opening" type="button"><i class="bi bi-clock-history"></i> Opening</button>
            <button class="filter-chip" data-status="offline" type="button"><i class="bi bi-x-circle"></i> Offline</button>
          </div>
        </section>
        <section class="sidebar-section">
          <h2>Vendor Alerts</h2>
          <div class="alert-badge"><i class="bi bi-bell-fill"></i> Sharma Chaat is 0.2km away!</div>
          <div class="alert-badge"><i class="bi bi-bell-fill"></i> Fresh Juice just opened!</div>
        </section>
        <section class="sidebar-section">
          <h2>Crowd Reports</h2>
          <ul class="sidebar-list">
            <li><span class="highlight">High traffic</span> at Connaught Place Metro</li>
            <li>Best time: evenings 6-8 PM</li>
            <li>New festival on Main Bazaar this weekend</li>
          </ul>
        </section>
        <section class="sidebar-section">
          <h2>Your Favorite Vendors</h2>
          <ul class="sidebar-list">
            <li>Sharma Chaat Corner</li>
            <li>Fresh Juice Hub</li>
            <li>Vada Pav Express</li>
            <li>Sweet Treats</li>
          </ul>
        </section>
      </aside>
    </div>
  </main>
  <script>
    // Correct nav bar logic: always dynamic
    (function(){
      const nav = document.getElementById('navLinks');
      let navItems = '';
      if(currentUserRole === 'vendor'){
        navItems =
          '<a href="/vendor-dashboard">Dashboard</a>' +
          '<a href="/vendor-orders">Orders</a>' +
          '<a href="/vendor-stories">Stories</a>' +
          '<a href="/vendor-produce">Market</a>' +
          '<a href="/shared-live-map" class="active" aria-current="page">Map</a>' +
          '<a href="/shared-profile" aria-label="User Profile"><i class="bi bi-person-circle"></i></a>';
      } else {
        navItems =
          '<a href="/buyer-dashboard">Dashboard</a>' +
          '<a href="/buyer-fresh-produce">Produce</a>' +
          '<a href="/buyer-vendor">Favorite Vendors</a>' +
          '<a href="/buyer-exchange">Ingredient Swap</a>' +
          '<a href="/shared-live-map" class="active" aria-current="page">Map</a>' +
          '<a href="/shared-stories-feed">Stories</a>' +
          '<a href="/shared-profile" aria-label="User Profile"><i class="bi bi-person-circle"></i></a>';
      }
      nav.innerHTML = navItems;
    })();

    // Map logic as before
    const map = L.map('map').setView([28.6139, 77.209], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    function createColoredCircleIcon(color) {
      return L.divIcon({
        className: '',
        html: `<span style="display:inline-block;width:16px;height:16px;background:${color};border: 3px solid white;border-radius:50%;box-shadow:0 0 6px 2px ${color}88;"></span>`,
        iconSize: [22, 22],
        iconAnchor: [11, 11],
        popupAnchor: [0, -11],
      });
    }
    const icons = {
      online: createColoredCircleIcon(getComputedStyle(document.documentElement).getPropertyValue('--primary').trim() || '#58c061'),
      opening: createColoredCircleIcon(getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#fbe27a'),
      offline: createColoredCircleIcon('#cfcfcf'),
    };
    const vendors = [
      { name: 'Sharma Chaat', latlng: [28.615, 77.205], status: 'online', popup: '<b>Sharma Chaat</b><br>68 orders today<br><span style="color:green;"><b>Online now</b></span>' },
      { name: 'Fresh Juice Hub', latlng: [28.6175, 77.213], status: 'opening', popup: '<b>Fresh Juice Hub</b><br>Opening in 10 mins<br><span style="color:orange;"><b>Opening Soon</b></span>' },
      { name: 'Vada Pav Express', latlng: [28.611, 77.21], status: 'offline', popup: '<b>Vada Pav Express</b><br>Closed<br><span style="color:gray;"><b>Offline</b></span>' },
      { name: 'Sweet Treats', latlng: [28.619, 77.199], status: 'online', popup: '<b>Sweet Treats</b><br>53 orders today<br><span style="color:green;"><b>Online now</b></span>' }
    ];
    const markers = [];
    vendors.forEach(vendor => {
      const marker = L.marker(vendor.latlng, { icon: icons[vendor.status] }).addTo(map);
      marker.bindPopup(vendor.popup);
      marker.vendorStatus = vendor.status;
      markers.push(marker);
    });
    document.querySelectorAll('.filter-chip').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-chip').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const status = btn.getAttribute('data-status');
        markers.forEach(marker => {
          if(status === 'all' || marker.vendorStatus === status){
            marker.addTo(map);
          } else {
            map.removeLayer(marker);
          }
        });
      });
    });
  </script>
</body>
</html>
